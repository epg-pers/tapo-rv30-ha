# Tapo RV30 — HA helpers and script for multi-room cleaning
#
# ⚠️  CUSTOMISE BEFORE USE
#   1. Rename this file to match your vacuum, e.g. my_vacuum.yaml
#   2. Replace every "jarvis" in entity IDs with your vacuum's name
#      (lowercase, spaces → underscores)
#   3. Replace room names ("Hallway", "Lounge" etc.) with your actual room names
#      as shown in the Tapo app
#   4. Add/remove input_boolean entries to match your number of rooms
#
# Installation:
#   1. Copy this file to /config/packages/<your_name>.yaml
#   2. Add to configuration.yaml if not already present:
#        homeassistant:
#          packages: !include_dir_named packages
#   3. Restart Home Assistant
#
# Alternatively, create helpers and the script manually via the HA UI —
# see the README for instructions.

input_boolean:
  jarvis_room_hallway:
    name: "Hallway"
    icon: mdi:door
  jarvis_room_lounge:
    name: "Lounge"
    icon: mdi:sofa
  jarvis_room_dining_room:
    name: "Dining Room"
    icon: mdi:table-chair
  jarvis_room_kitchen:
    name: "Kitchen"
    icon: mdi:countertop

script:
  jarvis_clean_selected_rooms:
    sequence:
      - variables:
          selected_rooms: >
            {% set ns = namespace(r=[]) %}
            {% if is_state('input_boolean.jarvis_room_hallway',    'on') %}{% set ns.r = ns.r + ['Hallway']     %}{% endif %}
            {% if is_state('input_boolean.jarvis_room_lounge',     'on') %}{% set ns.r = ns.r + ['Lounge']      %}{% endif %}
            {% if is_state('input_boolean.jarvis_room_dining_room','on') %}{% set ns.r = ns.r + ['Dining Room'] %}{% endif %}
            {% if is_state('input_boolean.jarvis_room_kitchen',    'on') %}{% set ns.r = ns.r + ['Kitchen']     %}{% endif %}
            {{ ns.r }}
      - service: tapo_rv30.clean_rooms
        data:
          entity_id: vacuum.jarvis
          rooms: "{{ selected_rooms }}"
